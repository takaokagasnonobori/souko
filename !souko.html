<!souko html>
<html>
<head>
  <title>バーコード入出庫管理</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #scanner { width: 300px; margin: auto; }
    #log { margin-top: 20px; max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; }
  </style>
</head>
<body>
  <h1>バーコード読み取り</h1>
  <div id="scanner"></div>
  <label>数量: <input type="number" id="quantity" min="1" value="1"></label>
  <button onclick="sendData()">記録</button>
  <div id="log"></div>

  <script>
    let lastScanned = "";
    const log = document.getElementById("log");

    function sendToSheet(code, qty) {
      fetch("https://script.google.com/macros/s/AKfycbyR2iLgmFKnjNG7zJ6WvXYGX7ohepg73-tFDRXUdTxEMKnGrmdtCuSldHsQMHvSo1R_/exec", {
        method: "POST",
        body: JSON.stringify({ code: code, quantity: qty }),
        headers: { "Content-Type": "application/json" }
      }).then(res => res.text()).then(txt => {
        log.innerHTML += `<div>✅ ${code} x ${qty} を保存しました。</div>`;
      });
    }

    function sendData() {
      if (lastScanned) {
        const qty = document.getElementById("quantity").value;
        sendToSheet(lastScanned, qty);
      }
    }

    const html5QrCode = new Html5Qrcode("scanner");
    html5QrCode.start({ facingMode: "environment" }, {
      fps: 10,
      qrbox: 250
    }, (decodedText) => {
      lastScanned = decodedText;
      log.innerHTML += `<div>📦 読み取り: ${decodedText}</div>`;
    }, (errorMessage) => {
      // エラー無視
    });
  </script>
</body>
</html>
