<!souko html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="style-src 'self' https://www.gstatic.com;">
  <title>å€‰åº«ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç®¡ç†</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
   body {
  font-family: sans-serif;
  font-size: 40px; /* ã•ã‚‰ã«æ‹¡å¤§ */
  padding: 30px;
}

#scanner {
  width: 100%;
  max-width: 440px;
  margin: 30px auto;
}

input[type="number"] {
  font-size: 40px;
  padding: 20px;
  width: 100%;
  max-width: 300px;
  margin-bottom: 20px;
  box-sizing: border-box;
}

button {
  font-size: 40px;
  padding: 24px 40px;
  margin: 12px 0;
  width: 100%;
  max-width: 320px;
  box-sizing: border-box;
}

.mode-btn {
  font-size: 38px;
  padding: 22px 32px;
}

#log {
  font-size: 36px;
  max-height: 400px;
  overflow-y: auto;
  border: 2px solid #ccc;
  padding: 16px;
}
  </style>
</head>
<body>
  <h2>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</h2>

  <div>
    <button class="mode-btn" onclick="setMode('å…¥åº«')">ğŸ“¥ å…¥åº«</button>
    <button class="mode-btn" onclick="setMode('å‡ºåº«')">ğŸ“¤ å‡ºåº«</button>
    <strong>ç¾åœ¨ãƒ¢ãƒ¼ãƒ‰: <span id="current-mode">å…¥åº«</span></strong>
  </div>

  <div id="scanner"></div>

  <label>æ•°é‡: <input type="number" id="quantity" min="1" value="1"></label>
  <button onclick="saveLog()">è¨˜éŒ²</button>

  <h3>èª­ã¿å–ã‚Šå±¥æ­´</h3>
  <div id="log"></div>

  <audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

  <script>
    let lastScanned = "";
    let currentMode = "å…¥åº«";

    function setMode(mode) {
      currentMode = mode;
      document.getElementById("current-mode").innerText = mode;
    }

    function saveLog() {
      if (!lastScanned) return;
      const qty = document.getElementById("quantity").value;

      fetch("https://script.google.com/macros/s/AKfycbyeVh3im3QZ8NSSALCTtpJ_q3zuyKwSngEaGtdVrh_-zVz85aR6uXNXIkFZSQZU8upz/exec", {
        method: "POST",
        body: JSON.stringify({
          code: lastScanned,
          quantity: qty,
          mode: currentMode
        }),
        headers: { "Content-Type": "application/json" }
      }).then(res => res.text()).then(txt => {
        document.getElementById("log").innerHTML += `<div>âœ… ${currentMode}: ${lastScanned} x ${qty} ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚</div>`;
      });
    }

    const beepSound = document.getElementById("beep");

    const html5QrCode = new Html5Qrcode("scanner");
    html5QrCode.start({ facingMode: "environment" }, {
      fps: 10,
      qrbox: 250
    }, (decodedText) => {
      lastScanned = decodedText;
      document.getElementById("log").innerHTML += `<div>ğŸ“¦ èª­ã¿å–ã‚Š: ${decodedText}</div>`;
      beepSound.play(); // æˆåŠŸæ™‚ã®éŸ³
    }, (errorMessage) => {
      // èª­ã¿å–ã‚Šå¤±æ•—ã¯ç„¡è¦–
    });
  </script>
</body>
</html>
